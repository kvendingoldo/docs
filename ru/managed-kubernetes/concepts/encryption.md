# Шифрование в {{ managed-k8s-name }}

В {{ yandex-cloud }} действует множество [мер обеспечения информационной безопасности](../../security/standarts.md). В том числе реализовано многоуровневое шифрование данных сервиса {{ managed-k8s-name }}:

* Данные шифруются при размещении в хранилище {{ yandex-cloud }} с помощью системных ключей. Это позволяет защитить данные от компрометации в случае физической кражи дисков из дата-центров {{ yandex-cloud }}.
* Данные шифруются при передаче по сети с помощью протокола TLS. Ключи для работы протокола TLS хранятся на хостах, на которых он используется. Это позволяет защитить данные от перехвата.

Используются следующие криптографические алгоритмы:
* симметричные: AES, ChaCha;
* асимметричные: RSA, Ed25519.

Минимальная длина ключа, используемая в симметричных алгоритмах, — 128 бит, в асимметричных — 2048 бит.

Управление этими ключами обеспечивает {{ yandex-cloud }}.

Также доступно [шифрование секретов {{ k8s }}](#k8s-secrets-encryption) с помощью [симметричного ключа шифрования](../../kms/concepts/key.md), который хранится в сервисе [{{ kms-full-name }}](../../kms/concepts/index.md).

Управление таким ключом происходит на стороне пользователя, что дает дополнительные возможности:

* Аудит [событий](../../kms/at-ref.md), связанных с использованием ключа, с помощью сервиса [{{ at-full-name }}](../../audit-trails/).
* Отслеживание работы с ключами с помощью сервиса [{{ monitoring-full-name }}](../../monitoring/).
* [Операции с ключами](../../kms/operations/index.md#symmetric-encryption) — ротация, изменение, деактивация, удаление.
* Гранулярный контроль [прав доступа к ключу](../../kms/security/index.md) на уровне отдельных [аккаунтов {{ yandex-cloud }}](../../iam/concepts/users/accounts.md).
* Применение [аппаратного модуля безопасности (HSM)](../../kms/concepts/hsm.md) при необходимости.

    {% note info %}

    В сервисе {{ managed-k8s-name }} сервисный аккаунт {{ yandex-cloud }} [называется](./index.md#service-accounts) облачным сервисным аккаунтом, чтобы избежать путаницы с сервисным аккаунтом {{ k8s }}.

    {% endnote %}

## Шифрование секретов {{ k8s }} {#k8s-secrets-encryption}

[_Секрет {{ k8s }}_](https://kubernetes.io/docs/concepts/configuration/secret/) — конфиденциальная информация, используемая кластером {{ k8s }} при управлении подами, например, OAuth-ключи, пароли, [SSH-ключи](../../glossary/ssh-keygen.md) и т. д.

По умолчанию секреты кластера хранятся в открытом виде. Если при [создании кластера {{ managed-k8s-name }}](../operations/kubernetes-cluster/kubernetes-cluster-create.md) был указан ключ шифрования, то секреты кластера шифруются.

{% note warning %}

Ключ шифрования можно указать только при создании кластера.

Если нужно использовать другой ключ, создайте новый кластер с этим ключом.

{% endnote %}

Процесс шифрования отдельного секрета происходит следующим образом:

1. {{ k8s }} шифрует секрет с помощью [KMS-провайдера](https://kubernetes.io/docs/tasks/administer-cluster/kms-provider/).

1. В процессе шифрования KMS-провайдер обращается к KMS-плагину, который позволяет использовать ключ шифрования, указанный при создании кластера.

    Этот ключ шифрования не используется для непосредственного шифрования секретов. Вместо этого применяется шифрование по схеме [envelope encryption](https://kubernetes.io/docs/tasks/administer-cluster/kms-provider/#kms-encryption-and-per-object-encryption-keys), в которой участвует ключ.

    Общее описание схемы приведено в разделе [{#T}](../../kms/concepts/envelope.md).

1. В процессе шифрования KMS-плагин обеспечивает взаимодействие с сервисом [{{ kms-full-name }}](../../kms/concepts/index.md), в котором хранится ключ шифрования.

    Этот плагин, как и использующий его провайдер, уже установлен в кластер {{ managed-k8s-name }} и настроен необходимым образом.

Расшифровка секрета происходит аналогичным образом.

## См. также {#see-also}

* [{#T}](../operations/applications/hashicorp-vault.md)
* [{#T}](../tutorials/marketplace/hashicorp-vault.md)
* [{#T}](../../kms/tutorials/k8s.md)
* [{#T}](../operations/applications/external-secrets-operator.md)
* [{#T}](../tutorials/kubernetes-lockbox-secrets.md)
