# Как работает параметр `Conn limit`


## Описание сценария {#case-description}

Необходимо разобраться, как работает параметр `Conn limit` в {{ mpg-name }}.

## Решение {#case-resolution}

Параметр `Conn limit` задает максимальное допустимое количество соединений для пользователя. В сессионном пулинге *(session pooling)* он ограничивает количество соединений пользователя с каждым хостом в {{ PG }}-кластере.

Основные принципы сессионного пулинга:

1. При создании пользователя {{ mpg-name }} по умолчанию резервирует для него 50 подключений к каждому хосту в {{ PG }}-кластере. Минимальное количество подключений на пользователя — 1;
1. Суммарное количество подключений, зарезервированных для пользователей, не должно превышать значение параметра `Max connections`. {{ mpg-name }} резервирует 15 служебных подключений на каждом хосте.

Например, если для кластера задана настройка `"max_connections": 100`, то вы можете зарезервировать не больше 85 подключений для пользователей на каждый хост кластера. При этом сумма значений настройки `Conn limit` у всех пользователей кластера не должна превышать значение 85.

{% note info %}

Настройка `Max connections` задает максимальное число одновременных подключений к хосту {{ PG }}. Минимальное значение — 1, максимальное значение и значение по умолчанию зависят от выбранного класса хостов и задаются формулой: 
```
200 × <количество vCPU на одном хосте>
```

{% endnote %}

Для хостов с гарантированной долей vCPU ниже 100% *(burstable)* используются фиксированные максимальные значения:

* `b1.nano`, `b1.micro`, `b2.nano`, `b2.micro` — 100;
* `b1.medium`, `b2.medium` — 200.

По умолчанию установлено максимальное значение.

С подробной информацией можно ознакомиться в [документации](../../../managed-postgresql/concepts/settings-list.md).