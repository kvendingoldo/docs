# Восстановление работоспособности кластера {{ mpg-name }} после исчерпания свободного места в хранилище данных


## Описание проблемы {#issue-description}

* Кластер {{ mpg-name }} работает в режиме только для чтения;
* Запись новых данных в таблицы баз данных кластера не производится.

## Диагностика и воспроизведение {#issue-diagnostics-and-reproduction}

Проанализируйте значения графика `Disk capacity on primary` на вкладке **{{ ui-key.yacloud.mdb.cluster.switch_monitoring }}** в [Консоли управления]({{ link-console-main }}) на предмет соотношения значений `free` и `used bytes` – это позволит оценить уровень заполнения хранилища кластера в процентах.

{% note info %}

При заполнении хранилища более чем на 95% хост автоматически переходит в режим `read-only`, при этом для всех баз данных с помощью запроса `ALTER DATABASE` выставляется флаг `DEFAULT_TRANSACTION_READ_ONLY = TRUE`.

В этом режиме запросы на вставку (`INSERT`), удаление (`DELETE`) или обновление (`UPDATE`) данных завершаются с ошибкой.

{% endnote %}

## Решение {#issue-resolution}

Такой ситуации можно избежать, если настроить оповещение на отслеживание перехода в `read-only`. Узнать подробнее о порядке действий для его настройки можно [в докумантации сервиса](../../../managed-postgresql/concepts/storage.md#read-only-monitor).

При получении оповещения вы сможете вывести кластер из этого режима двумя способами:

* С помощью [увеличения размера хранилища](../../../managed-postgresql/operations/storage-space.md) — в этом случае сервис автоматически снимет режим `read-only `;
* Вручную, следуя шагам из [инструкции](../../../managed-postgresql/concepts/storage.md#read-only-solutions).

Автоматического способа расширения хранилища кластера пока не предусмотрено.